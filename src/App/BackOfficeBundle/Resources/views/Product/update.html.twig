{% extends "AppBackOfficeBundle::pagelayout.html.twig" %}

{% block page_title %}Update {{ entity.name }}{% endblock %}

{% block content %}
    {% set product = entity %}
    <div class="container" data-product="{{ product.id }}">
        <div class="row">
            <div class="col-md-12">
                <h1>Update product #{{ product.id }}</h1>
                {#<form>#}
                    {#<div class="form-group">#}
                        {#<label for="name">Product name</label>#}
                        {#<input type="text" class="form-control" id="name" placeholder="Product name" name="name" value="{{ product.name }}" />#}
                    {#</div>#}
                    {#<div class="form-group">#}
                        {#<label for="availableFrom">Available since</label>#}
                        {#<input type="text" class="form-control" id="availableFrom" placeholder="Available from" name="availableFrom" value="{{ product.availableOn ? product.availableOn|date("d/m/Y H:i") : '-' }}" />#}
                    {#</div>#}

                    {#<div class="btn-group" role="group">#}
                        {#<button type="submit" class="btn btn-primary">Save</button>#}
                        {#<a class="btn btn-danger" href="{{ path('app_back_office_product_delete', {'id': entity.id}) }}" role="button">Delete</a>#}
                    {#</div>#}
                {#</form>#}
                <div>{{ form(form) }}</div>
                <h3>Product variants</h3>
                <table class="table" data-product-variants>
                    <thead>
                        <tr>
                            <td width="250">Name</td>
                            <td width="250">OS Product</td>
                            <td width="200">Actions</td>
                        </tr>
                    </thead>
                    <tbody id="product-variant-container"></tbody>
                </table>
                <div class="row">
                    <div class="col-xs-4 col-md-3 col-xl-2"><a class="btn btn-link" href="{{ path('app_back_office_product_index') }}">Back to list</a></div>
                </div>
            </div>
        </div>
    </div>
    {% include('AppBackOfficeBundle:BackOffice:modal_for_exist_image.html.twig') %}
    <!-- templates -->
    <table class="model-template">
        <tbody class="model-template product-variant">
            {%
                set lorem = {'variant': {
                    'id': ':id',
                    'name': ':name',
                    'options': {'0': {'value': ':option_name'}},
                    'osProduct': {'name': ':os_product_name'},
                    'enabled': ':enabled',
                    'availableOn': ':available_on'
                }}
            %}
            {% include 'AppBackOfficeBundle:Product/Include:edit_variant.html.twig' with lorem %}
        </tbody>
    </table>

    <div id="product-variant-editor-container"></div>


    <script id="productVariantTemplate" type="text/x-handlebars-template">
        <td>
            {% raw %}
                {{ name }}
            {% endraw %}
        </td>
        <td>
            {% raw %}
                {{ os_product }} (#{{ os_product_id }})
            {% endraw %}
        </td>
        <td>
            <div class="btn-group btn-group-sm" role="group">
                <a class="btn btn-primary" href="#" title="Edit settings" role="button" data-product-variant-edit-settings><i class="glyphicon glyphicon-wrench"></i></a>
                <a class="btn btn-default" href="#" title="Move up" role="button" data-product-variant-move-up><i class="glyphicon glyphicon-chevron-up"></i></a>
                <a class="btn btn-default" href="#" title="Move down" role="button" data-product-variant-move-down><i class="glyphicon glyphicon-chevron-down"></i></a>
                <a class="btn btn-danger" href="#" title="Remove variant" role="button" data-product-variant-remove><i class="glyphicon glyphicon-remove"></i></a>
            </div>
        </td>
    </script>
    
    <script id="productVariantEditTemplate" type="text/x-handlebars-template">
        <div class="modal" tabindex="-1">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <form>
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">Edit variant</h4>
                        </div>
                        <div class="modal-body">
                            
                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label for="settings_template_id">Settings template</label>
                                        <select class="form-control" name="settings_template_id" id="settings_template_id">
                                            {% if product_variant_settings is defined %}
                                                {% for settings in product_variant_settings %}
                                                    <option value="{{ settings.id }}">{{ settings.name }}</option>
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label for="os-product">OS product</label>
                                        <input type="text" name="os_product" class="form-control" placeholder="OS product" id="os-product" value="{% raw %}{{ os_product }}{% endraw %}" />
                                        <input type="hidden" name="os_product_id" value="{% raw %}{{ os_product_id }}{% endraw %}" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="column-content-2" id="settings-container"></div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-danger js-reset-to-default-product-variant">Reset to default settings</button>
                            <button type="submit" class="btn btn-primary">Save changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </script>

    <script id="productVariantCreateTemplate" type="text/x-handlebars-template">
        <td>
            <select class="form-control input-sm" name="settings_id" data-product-variant-settings>
                {% if product_variant_settings is defined %}
                    {% for settings in product_variant_settings %}
                        <option value="{{ settings.id }}">{{ settings.name }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </td>
        <td>
            <input type="text" name="os_product" class="form-control input-sm" placeholder="OS product" id="os-product" />
        </td>
        <td>
            <div class="btn-group btn-group-sm" role="group">
                <a class="btn btn-success" href="#" title="Add variant" role="button" data-product-variant-add><i class="glyphicon glyphicon-plus"></i></a>
            </div>
        </td>
    </script>

    {% raw %}
    <script id="productVariantEditSettingBooleanTemplate" type="text/x-handlebars-template"><div class="checkbox">
            <label>
                <input type="checkbox" name="settings[{{ key }}]" {{#if val}}checked{{/if}} > {{ name }}
            </label>
    </div></script>

    <script id="productVariantEditSettingTextTemplate" type="text/x-handlebars-template"><div class="form-group">
            <label for="{{ key }}">{{ name }}</label>
            <input type="text" name="settings[{{ key }}]" class="form-control" id="{{ key }}" placeholder="{{ name }}" value="{{ val }}" />
    </div></script>
    {% endraw %}

{% endblock %}

{% block footer_js %}
    {{ parent() }}
    <script>
        var productId = {{ entity.id }};
        var API_PATH_VARIANTS = '/rest/v1/shop/products/{:productId}/variants';
        var API_PATH_OSPRODUCTS = '/rest/v1/shop/osproducts';
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.2/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.2.3/backbone-min.js"></script>
    <script src="{{ asset('bundles/appbackoffice/js/product_variant_update.js') }}"></script>
    <script src="{{ asset('bundles/appbackoffice/js/existing_image_actions.js') }}"></script>
{% endblock %}